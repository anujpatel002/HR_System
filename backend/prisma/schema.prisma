generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model activity_logs {
  id         String       @id @default(uuid())
  userId     String
  action     ActivityType
  targetType String
  targetId   String?
  details    Json?
  createdAt  DateTime     @default(now())
  users      users        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([createdAt])
}

model attendance {
  id         String           @id @default(uuid())
  userId     String
  date       DateTime         @default(now())
  checkIn    DateTime?
  checkOut   DateTime?
  totalHours Float?
  status     AttendanceStatus @default(PRESENT)
  users      users            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, date])
  @@index([userId])
  @@index([date])
  @@index([status])
}

model employees {
  id            String    @id @default(uuid())
  userId        String    @unique
  dateOfBirth   DateTime?
  gender        String?
  maritalStatus String?
  nationality   String?
  personalEmail String?
  mobile        String?
  address       String?
  company       String?
  manager       String?
  location      String?
  dateOfJoining DateTime?
  empCode       String?
  bankName      String?
  accountNumber String?
  ifscCode      String?
  panNo         String?
  uanNo         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  users         users     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model leaves {
  id        String      @id @default(uuid())
  userId    String
  type      LeaveType
  startDate DateTime
  endDate   DateTime
  reason    String
  status    LeaveStatus @default(PENDING)
  createdAt DateTime    @default(now())
  users     users       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@index([createdAt])
}

model payrolls {
  id          String   @id @default(uuid())
  userId      String
  month       String
  year        Int
  basicSalary Float
  gross       Float
  pf          Float
  tax         Float
  deductions  Float
  netPay      Float
  createdAt   DateTime @default(now())
  users       users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, month, year])
  @@index([userId])
  @@index([year, month])
  @@index([createdAt])
}

model user_requests {
  id           String        @id @default(uuid())
  requesterId  String
  type         RequestType
  targetUserId String?
  data         Json
  status       RequestStatus @default(PENDING)
  adminNote    String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  users        users         @relation(fields: [requesterId], references: [id], onDelete: Cascade)

  @@index([requesterId])
  @@index([status])
  @@index([createdAt])
}

model user_sessions {
  id               String    @id @default(uuid())
  userId           String
  isActive         Boolean   @default(true)
  loginTime        DateTime  @default(now())
  logoutTime       DateTime?
  attendanceStatus String?
  ipAddress        String?
  userAgent        String?
  lastActivity     DateTime  @default(now())
  users            users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isActive])
  @@index([loginTime])
}

model users {
  id            String          @id @default(uuid())
  email         String          @unique
  name          String
  password      String
  role          Role            @default(EMPLOYEE)
  department    String?
  designation   String?
  basicSalary   Float?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  employeeId    String?         @unique
  bankName      String?
  panNo         String?
  uanNo         String?
  address       String?
  dateOfBirth   DateTime?
  gender        String?
  maritalStatus String?
  nationality   String?
  personalEmail String?
  mobile        String?
  company       String?
  manager       String?
  location      String?
  dateOfJoining DateTime?
  empCode       String?
  accountNumber String?
  ifscCode      String?
  activity_logs activity_logs[]
  attendance    attendance[]
  employees     employees?
  leaves        leaves[]
  payrolls      payrolls[]
  user_requests user_requests[]
  user_sessions user_sessions[]

  @@index([role])
  @@index([department])
  @@index([createdAt])
}

model work_settings {
  id              String   @id @default(uuid())
  workStartTime   String   @default("09:00")
  workEndTime     String   @default("17:00")
  workingDays     String   @default("1,2,3,4,5")
  lunchBreakStart String   @default("12:00")
  lunchBreakEnd   String   @default("13:00")
  checkInPopup    Boolean  @default(true)
  popupStartTime  String   @default("08:45")
  popupEndTime    String   @default("09:15")
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

enum ActivityType {
  CREATE
  UPDATE
  DELETE
  LOGIN
  LOGOUT
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  HALF_DAY
}

enum LeaveStatus {
  PENDING
  APPROVED
  REJECTED
}

enum LeaveType {
  SICK
  CASUAL
  ANNUAL
  MATERNITY
  PATERNITY
}

enum RequestStatus {
  PENDING
  APPROVED
  REJECTED
}

enum RequestType {
  CREATE_USER
  UPDATE_USER
  DELETE_USER
}

enum Role {
  ADMIN
  EMPLOYEE
  HR_OFFICER
  PAYROLL_OFFICER
  MANAGER
}

enum Department {
  IT
  HR
  FINANCE
  MARKETING
  OPERATIONS
  SALES
}
