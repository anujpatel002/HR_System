generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          String   @id @default(cuid())
  employeeId  String?  @unique
  email       String   @unique
  name        String
  password    String
  role        Role     @default(EMPLOYEE)
  department  String?
  designation String?
  basicSalary Float?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  attendance Attendance[]
  leaves     Leave[]
  payrolls   Payroll[]
  requests   UserRequest[]
  activities ActivityLog[]
  sessions   UserSession[]

  @@map("users")
}

model Attendance {
  id         String    @id @default(cuid())
  userId     String
  date       DateTime  @default(now())
  checkIn    DateTime?
  checkOut   DateTime?
  totalHours Float?
  status     AttendanceStatus @default(PRESENT)

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, date])
  @@map("attendance")
}

model Leave {
  id        String      @id @default(cuid())
  userId    String
  type      LeaveType
  startDate DateTime
  endDate   DateTime
  reason    String
  status    LeaveStatus @default(PENDING)
  createdAt DateTime    @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("leaves")
}

model Payroll {
  id         String   @id @default(cuid())
  userId     String
  month      String
  year       Int
  basicSalary Float
  gross      Float
  pf         Float
  tax        Float
  deductions Float
  netPay     Float
  createdAt  DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, month, year])
  @@map("payrolls")
}

model UserRequest {
  id          String        @id @default(cuid())
  requesterId String
  type        RequestType
  targetUserId String?
  data        Json
  status      RequestStatus @default(PENDING)
  adminNote   String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  requester User @relation(fields: [requesterId], references: [id], onDelete: Cascade)

  @@map("user_requests")
}

model ActivityLog {
  id          String       @id @default(cuid())
  userId      String
  action      ActivityType
  targetType  String
  targetId    String?
  details     Json?
  createdAt   DateTime     @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("activity_logs")
}

model UserSession {
  id            String    @id @default(cuid())
  userId        String
  isActive      Boolean   @default(true)
  loginTime     DateTime  @default(now())
  logoutTime    DateTime?
  attendanceStatus String?
  ipAddress     String?
  userAgent     String?
  lastActivity  DateTime  @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_sessions")
}

enum Role {
  ADMIN
  EMPLOYEE
  HR_OFFICER
  PAYROLL_OFFICER
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  HALF_DAY
}

enum LeaveType {
  SICK
  CASUAL
  ANNUAL
  MATERNITY
  PATERNITY
}

enum LeaveStatus {
  PENDING
  APPROVED
  REJECTED
}

enum RequestType {
  CREATE_USER
  UPDATE_USER
  DELETE_USER
}

enum RequestStatus {
  PENDING
  APPROVED
  REJECTED
}

enum ActivityType {
  CREATE
  UPDATE
  DELETE
  LOGIN
  LOGOUT
}